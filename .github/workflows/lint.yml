name: Lint

on:
  push:
    branches: [main]
  pull_request:

permissions:
  contents: read

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5 # v4.3.1

      - name: Validate shell syntax
        run: bash -n entrypoint.sh

      - name: Run actionlint
        run: |
          docker run --rm -v "${PWD}:/repo" -w /repo \
            rhysd/actionlint@sha256:6f03470d0152251d7f07f7c4dc019dbe7024c72cd952f839544c7798843efa8f \
            -color

      - name: Run shellcheck
        run: |
          docker run --rm -v "${PWD}:/repo" -w /repo \
            koalaman/shellcheck@sha256:bb596a0d169b85ddd81d8b6d3a2ff6d5baf5fca10b97f575ebc647c3dff62b3d \
            entrypoint.sh

      - name: Run hadolint
        run: |
          docker run --rm -i \
            hadolint/hadolint@sha256:27086352fd5e1907ea2b934eb1023f217c5ae087992eb59fde121dce9c9ff21e \
            < Dockerfile
